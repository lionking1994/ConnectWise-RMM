# ============================================
# ConnectWise & N-able RMM Integration Platform
# Environment Configuration Template
# ============================================
# Copy this file to .env and update with your actual values
# DO NOT commit .env to version control

# ============================================
# DATABASE CONFIGURATION
# ============================================
DB_HOST=postgres  # Use 'postgres' for Docker, 'localhost' for local dev
DB_PORT=5432
DB_USER=rmm_user
DB_PASSWORD=CHANGE_THIS_STRONG_PASSWORD  # Use strong password in production
DB_NAME=rmm_platform
DATABASE_URL=postgresql://rmm_user:CHANGE_THIS_STRONG_PASSWORD@postgres:5432/rmm_platform

# ============================================
# APPLICATION CONFIGURATION
# ============================================
NODE_ENV=production  # Options: development, production, staging
BACKEND_PORT=3001
FRONTEND_PORT=3000
API_URL=http://backend:3001  # Internal Docker network URL
FRONTEND_URL=http://localhost:3000  # Public-facing URL

# Security Keys (MUST CHANGE IN PRODUCTION)
JWT_SECRET=CHANGE_THIS_64_CHAR_RANDOM_STRING_FOR_PRODUCTION
JWT_EXPIRES_IN=24h
REFRESH_TOKEN_EXPIRES_IN=7d
ENCRYPTION_KEY=CHANGE_THIS_32_CHAR_KEY_FOR_PRODUCTION

# ============================================
# CONNECTWISE PSA CONFIGURATION
# ============================================
# API Configuration
# URL Format: https://api-{region}.myconnectwise.net/{version}/apis/3.0
# Regions: na (North America), eu (Europe), au (Australia), za (South Africa)
CONNECTWISE_API_URL=https://api-na.myconnectwise.net/v4_6_release/apis/3.0
CONNECTWISE_COMPANY_ID=YOUR_COMPANY_ID  # Your MSP company identifier (e.g., "TechMSP")
CONNECTWISE_PUBLIC_KEY=YOUR_PUBLIC_KEY  # From Setup > Members > API Members
CONNECTWISE_PRIVATE_KEY=YOUR_PRIVATE_KEY  # From Setup > Members > API Members
CONNECTWISE_CLIENT_ID=YOUR_CLIENT_ID  # Your integrator account client ID

# Board Configuration (OPTIONAL - Not needed when N-able creates tickets)
# Board management has been disabled since N-able handles ticket creation
# Uncomment only if you need to filter or organize tickets by board
# CW_DEFAULT_BOARD_ID=10  # Network Operations Center board ID
# CW_DEFAULT_BOARD_NAME=Network Operations Center
# CW_BOARD_IDS=10,11,12  # Comma-separated list of board IDs to monitor
# CW_DEFAULT_COMPANY_ID - NOT NEEDED when N-able creates tickets (company already assigned)

# Webhook Configuration (Optional - for receiving CW events)
CONNECTWISE_WEBHOOK_SECRET=YOUR_WEBHOOK_SECRET  # For signature verification
CONNECTWISE_URL=https://your.connectwise.url  # Your CW instance URL

# ============================================
# N-ABLE RMM CONFIGURATION
# ============================================
# N-sight RMM API Configuration
# Documentation: https://developer.n-able.com/n-sight/docs/getting-started-with-the-n-sight-api
# 
# N-sight uses query parameter authentication format:
# https://{server}/api/?apikey={yourAPIkey}&service={service_name}
#
# Server URLs by region:
# - North America: https://www.systemmonitor.us
# - Europe: https://www.systemmonitor.eu  
# - Australia: https://www.systemmonitor.com.au
#
NABLE_API_URL=https://www.systemmonitor.us  # Your N-sight RMM server URL
NABLE_API_KEY=YOUR_NSIGHT_API_KEY  # Your N-sight API key from System > API Keys
# NABLE_API_SECRET=  # Not used for N-sight RMM

# Alternative: N-able N-central Configuration (if using N-central instead)
# NABLE_API_URL=https://your-ncentral-server.com
# NABLE_API_KEY=YOUR_NCENTRAL_API_KEY
# NABLE_API_SECRET=YOUR_NCENTRAL_API_SECRET

# Script Configuration
NABLE_SCRIPT_TIMEOUT=300000  # Script execution timeout in ms (5 minutes)
NABLE_MAX_RETRIES=3  # Maximum script retry attempts

# ============================================
# DUPLICATE TICKET PREVENTION
# ============================================
# IMPORTANT: These settings prevent creating duplicate tickets
# when N-able's built-in integration already creates CW tickets
# Since N-able creates tickets with company ID assigned, CW_DEFAULT_COMPANY_ID is not needed

PREVENT_DUPLICATE_TICKETS=true  # Set to true to prevent duplicates
TICKET_MATCH_TIME_WINDOW_MINUTES=30  # Look for tickets created within this window
AUTO_LINK_TICKETS=true  # Automatically link N-able alerts to CW tickets
UPDATE_ONLY_MODE=false  # If true, ONLY update existing tickets, never create
CREATE_NEW_CW_TICKETS=false  # Set to false if N-able already creates CW tickets
SYNC_TICKET_NOTES=true  # Sync all notes between systems

# ============================================
# MICROSOFT TEAMS INTEGRATION
# ============================================
MS_TEAMS_WEBHOOK_URL=https://outlook.office.com/webhook/YOUR_WEBHOOK_URL
MS_TEAMS_BOT_ID=YOUR_BOT_ID  # For interactive cards (optional)
MS_TEAMS_TENANT_ID=YOUR_TENANT_ID  # For bot framework (optional)
MS_TEAMS_ENABLED=true  # Enable/disable Teams notifications

# Teams Notification Settings
TEAMS_ALERT_CHANNEL=general  # Channel for alerts
TEAMS_ESCALATION_MENTIONS=@on-call-team  # Who to mention for escalations

# ============================================
# EMAIL CONFIGURATION (OPTIONAL)
# ============================================
EMAIL_ENABLED=false  # Set to true to enable email notifications
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_SECURE=false  # true for 465, false for other ports
SMTP_USER=your-email@company.com
SMTP_PASS=your-app-specific-password
EMAIL_FROM=RMM Platform <noreply@company.com>

# Escalation Email Settings
ESCALATION_EMAIL=it-oncall@company.com  # Primary escalation email
ESCALATION_EMAILS=it-oncall@company.com,manager@company.com  # Multiple recipients

# ============================================
# SLACK CONFIGURATION (FUTURE)
# ============================================
SLACK_ENABLED=false  # Set to true when ready to use Slack
SLACK_WEBHOOK_URL=https://hooks.slack.com/services/YOUR/WEBHOOK/URL
SLACK_BOT_TOKEN=xoxb-your-token
SLACK_CHANNEL=#alerts

# ============================================
# AUTOMATION ENGINE SETTINGS
# ============================================
# Concurrency and Performance
AUTOMATION_ENABLED=true
AUTOMATION_CONCURRENCY=5  # Number of parallel automation executions
AUTOMATION_QUEUE_INTERVAL=1000  # Queue check interval in ms
AUTOMATION_MAX_QUEUE_SIZE=100  # Maximum queued automations

# Script Execution
SCRIPT_EXECUTION_TIMEOUT=300  # Default script timeout in seconds
SIMULATE_SCRIPTS=false  # Set to true for testing without actual execution
SCRIPT_DRY_RUN=false  # Run scripts in "what-if" mode
DEFAULT_SCRIPT_RETRIES=2  # Number of retries for failed scripts

# Auto-Remediation Settings
AUTO_REMEDIATION_ENABLED=true  # Enable automatic script execution
AUTO_CLOSE_ON_SUCCESS=true  # Auto-close tickets after successful remediation
AUTO_ESCALATE_ON_FAILURE=true  # Auto-escalate after failed remediation
ESCALATION_FAILURE_THRESHOLD=2  # Number of failures before escalation

# ============================================
# WEBHOOK CONFIGURATION
# ============================================
# Your server's webhook endpoints for receiving events
WEBHOOK_BASE_URL=http://your-server.com:3001/api/webhook
NABLE_WEBHOOK_PATH=/api/webhook/nable
CW_WEBHOOK_PATH=/api/webhook/connectwise
TEAMS_WEBHOOK_PATH=/api/webhook/teams/action

# Webhook Security
WEBHOOK_SIGNATURE_REQUIRED=false  # Require signature verification
WEBHOOK_IP_WHITELIST=  # Comma-separated IP whitelist (optional)

# ============================================
# MONITORING & LOGGING
# ============================================
LOG_LEVEL=info  # Options: error, warn, info, debug
LOG_TO_FILE=true
LOG_FILE_PATH=./logs
LOG_MAX_FILES=30d  # Keep logs for 30 days
ENABLE_PERFORMANCE_MONITORING=true
ENABLE_ERROR_TRACKING=true

# Metrics and Analytics
ENABLE_METRICS=true
METRICS_PORT=9090  # Prometheus metrics endpoint
HEALTH_CHECK_INTERVAL=30000  # Health check interval in ms

# ============================================
# REDIS CONFIGURATION (FOR CACHING & QUEUES)
# ============================================
REDIS_HOST=redis  # Use 'redis' for Docker, 'localhost' for local
REDIS_PORT=6379
REDIS_PASSWORD=  # Leave empty if no password
REDIS_DB=0
CACHE_TTL=3600  # Cache TTL in seconds (1 hour)

# ============================================
# SECURITY SETTINGS
# ============================================
# CORS Configuration
CORS_ENABLED=true
CORS_ORIGIN=http://localhost:3000  # Frontend URL
ALLOWED_ORIGINS=http://localhost:3000,https://your-domain.com

# Rate Limiting
RATE_LIMIT_ENABLED=true
RATE_LIMIT_WINDOW_MS=900000  # 15 minutes
RATE_LIMIT_MAX_REQUESTS=100  # Max requests per window

# Session Configuration
SESSION_SECRET=CHANGE_THIS_RANDOM_STRING
SESSION_TIMEOUT=86400000  # 24 hours in ms

# ============================================
# DEVELOPMENT & TESTING
# ============================================
# Development Mode Settings
DEV_MODE=false  # Enable development features
DEBUG_MODE=false  # Enable debug logging
SIMULATE_NABLE=false  # Use mock N-able data
SIMULATE_CONNECTWISE=false  # Use mock ConnectWise data
USE_TEST_DATABASE=false  # Use separate test database

# Test Environment
TEST_DB_NAME=rmm_platform_test
TEST_USER_EMAIL=admin@test.com
TEST_USER_PASSWORD=Test123!

# ============================================
# FEATURE FLAGS
# ============================================
FEATURE_TICKET_SYNC=true
FEATURE_AUTO_REMEDIATION=true
FEATURE_TEAMS_COMMANDS=true
FEATURE_EMAIL_NOTIFICATIONS=true
FEATURE_DASHBOARD_ANALYTICS=true
FEATURE_AUDIT_LOGGING=true
FEATURE_SCRIPT_TEMPLATES=true
FEATURE_BOARD_MANAGEMENT=true

# ============================================
# BACKUP & MAINTENANCE
# ============================================
BACKUP_ENABLED=false
BACKUP_SCHEDULE=0 2 * * *  # Daily at 2 AM
BACKUP_RETENTION_DAYS=30
BACKUP_PATH=/backups
MAINTENANCE_MODE=false
MAINTENANCE_MESSAGE=System under maintenance

# ============================================
# INTEGRATION NOTES
# ============================================
# 1. ConnectWise API Keys: Get from Setup > Members > API Members
# 2. N-able API Keys: Get from Administration > API Access
# 3. Teams Webhook: Create in Teams Channel > Connectors > Incoming Webhook
# 4. Set UPDATE_ONLY_MODE=true if N-able already creates CW tickets
# 5. Ensure Network Operations Center board ID is correct
# 6. Test with SIMULATE_SCRIPTS=true before production deployment
# CW_DEFAULT_BOARD_ID=10  # Network Operations Center board ID
# CW_DEFAULT_BOARD_NAME=Network Operations Center
# CW_BOARD_IDS=10,11,12  # Comma-separated list of board IDs to monitor
# CW_DEFAULT_COMPANY_ID - NOT NEEDED when N-able creates tickets (company already assigned)

# Webhook Configuration (Optional - for receiving CW events)
CONNECTWISE_WEBHOOK_SECRET=YOUR_WEBHOOK_SECRET  # For signature verification
CONNECTWISE_URL=https://your.connectwise.url  # Your CW instance URL

# ============================================
# N-ABLE RMM CONFIGURATION
# ============================================
# N-sight RMM API Configuration
# Documentation: https://developer.n-able.com/n-sight/docs/getting-started-with-the-n-sight-api
# 
# N-sight uses query parameter authentication format:
# https://{server}/api/?apikey={yourAPIkey}&service={service_name}
#
# Server URLs by region:
# - North America: https://www.systemmonitor.us
# - Europe: https://www.systemmonitor.eu  
# - Australia: https://www.systemmonitor.com.au
#
NABLE_API_URL=https://www.systemmonitor.us  # Your N-sight RMM server URL
NABLE_API_KEY=YOUR_NSIGHT_API_KEY  # Your N-sight API key from System > API Keys
# NABLE_API_SECRET=  # Not used for N-sight RMM

# Alternative: N-able N-central Configuration (if using N-central instead)
# NABLE_API_URL=https://your-ncentral-server.com
# NABLE_API_KEY=YOUR_NCENTRAL_API_KEY
# NABLE_API_SECRET=YOUR_NCENTRAL_API_SECRET

# Script Configuration
NABLE_SCRIPT_TIMEOUT=300000  # Script execution timeout in ms (5 minutes)
NABLE_MAX_RETRIES=3  # Maximum script retry attempts

# ============================================
# DUPLICATE TICKET PREVENTION
# ============================================
# IMPORTANT: These settings prevent creating duplicate tickets
# when N-able's built-in integration already creates CW tickets
# Since N-able creates tickets with company ID assigned, CW_DEFAULT_COMPANY_ID is not needed

PREVENT_DUPLICATE_TICKETS=true  # Set to true to prevent duplicates
TICKET_MATCH_TIME_WINDOW_MINUTES=30  # Look for tickets created within this window
AUTO_LINK_TICKETS=true  # Automatically link N-able alerts to CW tickets
UPDATE_ONLY_MODE=false  # If true, ONLY update existing tickets, never create
CREATE_NEW_CW_TICKETS=false  # Set to false if N-able already creates CW tickets
SYNC_TICKET_NOTES=true  # Sync all notes between systems

# ============================================
# MICROSOFT TEAMS INTEGRATION
# ============================================
MS_TEAMS_WEBHOOK_URL=https://outlook.office.com/webhook/YOUR_WEBHOOK_URL
MS_TEAMS_BOT_ID=YOUR_BOT_ID  # For interactive cards (optional)
MS_TEAMS_TENANT_ID=YOUR_TENANT_ID  # For bot framework (optional)
MS_TEAMS_ENABLED=true  # Enable/disable Teams notifications

# Teams Notification Settings
TEAMS_ALERT_CHANNEL=general  # Channel for alerts
TEAMS_ESCALATION_MENTIONS=@on-call-team  # Who to mention for escalations

# ============================================
# EMAIL CONFIGURATION (OPTIONAL)
# ============================================
EMAIL_ENABLED=false  # Set to true to enable email notifications
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_SECURE=false  # true for 465, false for other ports
SMTP_USER=your-email@company.com
SMTP_PASS=your-app-specific-password
EMAIL_FROM=RMM Platform <noreply@company.com>

# Escalation Email Settings
ESCALATION_EMAIL=it-oncall@company.com  # Primary escalation email
ESCALATION_EMAILS=it-oncall@company.com,manager@company.com  # Multiple recipients

# ============================================
# SLACK CONFIGURATION (FUTURE)
# ============================================
SLACK_ENABLED=false  # Set to true when ready to use Slack
SLACK_WEBHOOK_URL=https://hooks.slack.com/services/YOUR/WEBHOOK/URL
SLACK_BOT_TOKEN=xoxb-your-token
SLACK_CHANNEL=#alerts

# ============================================
# AUTOMATION ENGINE SETTINGS
# ============================================
# Concurrency and Performance
AUTOMATION_ENABLED=true
AUTOMATION_CONCURRENCY=5  # Number of parallel automation executions
AUTOMATION_QUEUE_INTERVAL=1000  # Queue check interval in ms
AUTOMATION_MAX_QUEUE_SIZE=100  # Maximum queued automations

# Script Execution
SCRIPT_EXECUTION_TIMEOUT=300  # Default script timeout in seconds
SIMULATE_SCRIPTS=false  # Set to true for testing without actual execution
SCRIPT_DRY_RUN=false  # Run scripts in "what-if" mode
DEFAULT_SCRIPT_RETRIES=2  # Number of retries for failed scripts

# Auto-Remediation Settings
AUTO_REMEDIATION_ENABLED=true  # Enable automatic script execution
AUTO_CLOSE_ON_SUCCESS=true  # Auto-close tickets after successful remediation
AUTO_ESCALATE_ON_FAILURE=true  # Auto-escalate after failed remediation
ESCALATION_FAILURE_THRESHOLD=2  # Number of failures before escalation

# ============================================
# WEBHOOK CONFIGURATION
# ============================================
# Your server's webhook endpoints for receiving events
WEBHOOK_BASE_URL=http://your-server.com:3001/api/webhook
NABLE_WEBHOOK_PATH=/api/webhook/nable
CW_WEBHOOK_PATH=/api/webhook/connectwise
TEAMS_WEBHOOK_PATH=/api/webhook/teams/action

# Webhook Security
WEBHOOK_SIGNATURE_REQUIRED=false  # Require signature verification
WEBHOOK_IP_WHITELIST=  # Comma-separated IP whitelist (optional)

# ============================================
# MONITORING & LOGGING
# ============================================
LOG_LEVEL=info  # Options: error, warn, info, debug
LOG_TO_FILE=true
LOG_FILE_PATH=./logs
LOG_MAX_FILES=30d  # Keep logs for 30 days
ENABLE_PERFORMANCE_MONITORING=true
ENABLE_ERROR_TRACKING=true

# Metrics and Analytics
ENABLE_METRICS=true
METRICS_PORT=9090  # Prometheus metrics endpoint
HEALTH_CHECK_INTERVAL=30000  # Health check interval in ms

# ============================================
# REDIS CONFIGURATION (FOR CACHING & QUEUES)
# ============================================
REDIS_HOST=redis  # Use 'redis' for Docker, 'localhost' for local
REDIS_PORT=6379
REDIS_PASSWORD=  # Leave empty if no password
REDIS_DB=0
CACHE_TTL=3600  # Cache TTL in seconds (1 hour)

# ============================================
# SECURITY SETTINGS
# ============================================
# CORS Configuration
CORS_ENABLED=true
CORS_ORIGIN=http://localhost:3000  # Frontend URL
ALLOWED_ORIGINS=http://localhost:3000,https://your-domain.com

# Rate Limiting
RATE_LIMIT_ENABLED=true
RATE_LIMIT_WINDOW_MS=900000  # 15 minutes
RATE_LIMIT_MAX_REQUESTS=100  # Max requests per window

# Session Configuration
SESSION_SECRET=CHANGE_THIS_RANDOM_STRING
SESSION_TIMEOUT=86400000  # 24 hours in ms

# ============================================
# DEVELOPMENT & TESTING
# ============================================
# Development Mode Settings
DEV_MODE=false  # Enable development features
DEBUG_MODE=false  # Enable debug logging
SIMULATE_NABLE=false  # Use mock N-able data
SIMULATE_CONNECTWISE=false  # Use mock ConnectWise data
USE_TEST_DATABASE=false  # Use separate test database

# Test Environment
TEST_DB_NAME=rmm_platform_test
TEST_USER_EMAIL=admin@test.com
TEST_USER_PASSWORD=Test123!

# ============================================
# FEATURE FLAGS
# ============================================
FEATURE_TICKET_SYNC=true
FEATURE_AUTO_REMEDIATION=true
FEATURE_TEAMS_COMMANDS=true
FEATURE_EMAIL_NOTIFICATIONS=true
FEATURE_DASHBOARD_ANALYTICS=true
FEATURE_AUDIT_LOGGING=true
FEATURE_SCRIPT_TEMPLATES=true
FEATURE_BOARD_MANAGEMENT=true

# ============================================
# BACKUP & MAINTENANCE
# ============================================
BACKUP_ENABLED=false
BACKUP_SCHEDULE=0 2 * * *  # Daily at 2 AM
BACKUP_RETENTION_DAYS=30
BACKUP_PATH=/backups
MAINTENANCE_MODE=false
MAINTENANCE_MESSAGE=System under maintenance

# ============================================
# INTEGRATION NOTES
# ============================================
# 1. ConnectWise API Keys: Get from Setup > Members > API Members
# 2. N-able API Keys: Get from Administration > API Access
# 3. Teams Webhook: Create in Teams Channel > Connectors > Incoming Webhook
# 4. Set UPDATE_ONLY_MODE=true if N-able already creates CW tickets
# 5. Ensure Network Operations Center board ID is correct
# 6. Test with SIMULATE_SCRIPTS=true before production deployment